{% extends "base.html" %}
  {% block main %}
  {% if posts %}
    {% for post, like, user_like in posts %}
      <div class="container-lg px-4 py-4 post_border my-4">
        <div class="mb-3">
          <div class="post-header">
            <img src="{{ url_for('static', filename='compass.svg') }}" alt="avatar" class="avatar">
            <div class="meta">
              <div><strong><a href="/{{post.id}}">{{post.name}}</a></strong></div>
              <div class="text-muted" style="font-size:0.85rem">#{{post.post_id}} · {{post.time}}</div>
            </div>
          </div>

          <div class="post-title">{{ post.title }}</div>

          {% if post.image %}
            <img src="{{ url_for('static', filename=post.image) }}" alt="post image" class="post-image">
          {% endif %}

          <div class="post-content">{{ post.post }}</div>

          <div class="post-actions mt-3 d-flex align-items-center gap-2">
            {% if user_like %}
              <a class="btn btn-sm btn-outline-primary" href="/unlike-action/{{post.post_id}}">Unlike <span class="badge bg-secondary">{{ like }}</span></a>
            {% else %}
              <a class="btn btn-sm btn-outline-success" href="/like-action/{{post.post_id}}">Like <span class="badge bg-secondary">{{ like }}</span></a>
            {% endif %}
            {% if delete %}
              <a class="btn btn-sm btn-outline-danger" href="/edit-post/{{post.post_id}}">Edit</a>
            {% endif %}
          </div>

          <!-- Comments -->
          <div class="comments mt-3">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-0">Comments ({{ post.comments.count() }})</h6>
            </div>
            <div class="mt-2">
            {% for c in post.comments.all() %}
              <div class="comment py-2">
                <div class="d-flex justify-content-between">
                  <div class="comment-left">
                    <img src="{{ url_for('static', filename='compass.svg') }}" alt="avatar" class="avatar-sm">
                    <div class="comment-right">
                      <div class="comment-meta"><strong>{{ c.name }}</strong> · <small class="text-muted">{{ c.time }}</small></div>
                      <div class="comment-body">{{ c.comment }}</div>
                    </div>
                  </div>
                  {% if userid == c.user_id %}
                    <div class="comment-actions align-self-start">
                      <a href="/delete-comment/{{ c.comment_id }}" class="text-danger small" aria-label="Delete comment">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                          <path d="M5.5 5.5A.5.5 0 0 1 6 5h4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5H6a.5.5 0 0 1-.5-.5v-7z"/>
                          <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 1 1 0-2H5.5a1 1 0 0 1 .858.485L7.118 3h1.764l.76-1.515A1 1 0 0 1 10.5 1h3a1 1 0 0 1 1 1z"/>
                        </svg>
                      </a>
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
            </div>

            {% if userid %}
              <form method="POST" action="/comment/{{ post.post_id }}" class="mt-3 comment-form">
                <div class="mb-2">
                  <textarea class="form-control" name="comment" rows="2" placeholder="Write a comment..." required></textarea>
                </div>
                <div class="d-flex justify-content-end">
                  <button class="btn btn-sm btn-primary" type="submit">Comment</button>
                </div>
              </form>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
      <div class="container-lg px-4 py-4 post_border my-4">
      <div class="mb-3">
      <center><h2>No! Blogs Yet!</h2></center>
      </div>
      </div>
  {% endif %}

    
  {% endblock %} 